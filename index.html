<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacano Store | Selecciona tu País</title>
    <link rel="icon" href="imagenes/logo.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Definición de variables CSS para los colores */
        :root {
            --color-primary-dark: #1e3a8a; /* Azul oscuro para un look moderno */
            --color-primary-light: #3b82f6; /* Azul claro para acentos */
            --color-secondary-dark: #6366f1; /* Púrpura sutil para degradados */
            --color-secondary-light: #a78bfa; /* Púrpura más claro */
            --color-text-dark: #1f2937; /* Gris oscuro para texto principal */
            --color-text-light: #4b5563; /* Gris medio para texto secundario */
            --color-bg-light: #f9fafb; /* Fondo muy claro (para el contenedor si se usa) */
            --color-bg-white: #ffffff; /* Blanco puro */
            --color-shadow: rgba(0, 0, 0, 0.1);
            --color-border: #e5e7eb;
            --color-button-hover: #e0e7ff; /* Un azul muy suave para hover */

            /* Nuevas variables para el degradado del fondo */
            --gradient-start: #1e3a8a; /* Un azul oscuro como el que ya tienes */
            --gradient-mid: #3b82f6;    /* Un azul medio */
            --gradient-end: #6366f1;    /* Un púrpura/azul más oscuro */
        }

        /* Estilos generales */
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            /* CAMBIO CLAVE AQUÍ: Nuevo fondo degradado */
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid), var(--gradient-end));
            background-size: 400% 400%; /* Permite la animación de fondo */
            animation: gradientAnimation 15s ease infinite; /* Animación para un fondo dinámico */
            color: var(--color-text-dark); /* El color del texto principal en el contenedor */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden; /* Oculta el scrollbar */
        }

        /* Animación para el degradado del fondo */
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Estilos del Preloader --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* El preloader puede tener un degradado diferente si quieres, o el mismo del body */
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-secondary-light)); 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.7s ease-out;
            color: white; /* Texto blanco sobre el degradado del preloader */
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid white;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            animation: spin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            margin-bottom: 25px;
            box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loading-text {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 15px;
        }

        #loading-region {
            font-size: 1.2em;
            font-weight: 300;
            opacity: 0.8;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #loading-icon-display {
            font-size: 1.5em;
            margin-left: 10px;
            line-height: 1;
        }

        /* --- Estilos del Contenido Principal --- */
        .container {
            max-width: 700px;
            padding: 60px;
            /* CAMBIO OPCIONAL: El contenedor ahora tiene un fondo blanco sólido para destacar sobre el degradado del body */
            background-color: var(--color-bg-white); 
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* Sombra más pronunciada para pop-out */
            animation: fadeIn 1s ease-out forwards;
            border: none;
            position: relative;
            overflow: hidden;
            z-index: 1; /* Asegurarse de que esté por encima del fondo */
        }

        /* Degradado sutil en el fondo del container - AHORA SOLO DECORATIVO SI EL FONDO DEL CONTAINER ES BLANCO */
        .container::before {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            /* Si el fondo del container es blanco, este efecto puede ser menos visible o innecesario */
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05)); /* Degradado más sutil o casi transparente */
            z-index: -1;
            filter: blur(20px);
            opacity: 0.7;
            border-radius: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            font-weight: 800;
            /* Mantiene el degradado de texto para el título */
            background-image: linear-gradient(45deg, var(--color-primary-dark), var(--color-primary-light), var(--color-secondary-dark));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            letter-spacing: -1px;
            position: relative;
            animation: textReveal 1s ease-out 0.5s forwards;
        }

        @keyframes textReveal {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        h2 {
            font-size: 1.8em;
            color: var(--color-text-light); /* Color gris medio para subtítulos */
            margin-top: 0px;
            margin-bottom: 50px;
            font-weight: 400;
            letter-spacing: 0.5px;
            animation: textReveal 1s ease-out 0.7s forwards;
        }

        p {
            font-size: 1.25em;
            margin-bottom: 50px;
            line-height: 1.8;
            color: var(--color-text-light); /* Color gris medio para párrafos */
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            animation: textReveal 1s ease-out 0.9s forwards;
        }

        .country-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
            animation: buttonsFadeIn 1s ease-out 1.2s forwards;
            opacity: 0;
        }

        @keyframes buttonsFadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .country-selection a {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-bg-white); /* Botones blancos por defecto */
            color: var(--color-primary-dark);
            padding: 18px 25px;
            border-radius: 10px;
            text-decoration: none;
            font-size: 1.15em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--color-border);
            position: relative;
            overflow: hidden;
        }

        .country-selection a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-secondary-light));
            transition: all 0.4s ease;
            z-index: -1;
            opacity: 0;
        }

        .country-selection a:hover::before {
            left: 0;
            opacity: 1;
        }

        .country-selection a:hover {
            color: white;
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
            border-color: transparent;
        }

        .country-selection a:hover .flag-emoji {
            transform: scale(1.1);
        }

        .flag-emoji {
            font-size: 2.2em;
            margin-right: 15px;
            line-height: 1;
            transition: transform 0.3s ease;
        }

        /* Medias queries para dispositivos móviles */
        @media (max-width: 768px) {
            .container {
                padding: 40px 25px;
            }
            h1 {
                font-size: 2.5em;
                letter-spacing: 0;
            }
            h2 {
                font-size: 1.4em;
                margin-bottom: 35px;
            }
            p {
                font-size: 1.05em;
                margin-bottom: 35px;
            }
            .country-selection {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .country-selection a {
                padding: 16px 20px;
                font-size: 1.05em;
                min-width: unset;
            }
            .flag-emoji {
                font-size: 1.8em;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="preloader">
        <div class="spinner"></div>
        <div id="loading-text">Cargando</div>
        <div id="loading-region">Detectando tu región...</div>
        <div id="loading-icon-display"></div>
    </div>

    <div class="container" id="main-content">
        <h1>Vacano Store</h1>
        <h2>Tu Tienda Online</h2>
        <p>Experimenta la moda sin límites. Selecciona tu país para explorar nuestro catálogo exclusivo y ofertas adaptadas a tu región.</p>
        <div class="country-selection">
            <a href="venezuela/index.html"><span class="flag-emoji">🇻🇪</span>Venezuela</a>
            <a href="peru/index.html"><span class="flag-emoji">🇵🇪</span>Perú</a>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const preloader = document.getElementById('preloader');
            const loadingText = document.getElementById('loading-text');
            const loadingRegion = document.getElementById('loading-region');
            const loadingIconDisplay = document.getElementById('loading-icon-display');
            const mainContent = document.getElementById('main-content');

            // Mapeo de códigos de país a URLs
            const countryRedirects = {
                'VEN': { url: 'venezuela/index.html', name: 'Venezuela', emoji: '🇻🇪' },
                'PER': { url: 'peru/index.html', name: 'Perú', emoji: '🇵🇪' },
                // Añade más países si es necesario (usa el código de 3 letras del país)
            };

            // Redirección por defecto si el país no está en la lista o la detección falla/es negada
            const defaultRedirect = { 
                url: 'venezuela/index.html', 
                name: 'Venezuela (por defecto)', 
                emoji: '🇻🇪' 
            }; 

            /**
             * Oculta el preloader y muestra el contenido principal.
             */
            function hidePreloader() {
                preloader.style.opacity = '0';
                setTimeout(() => {
                    preloader.style.display = 'none';
                    mainContent.style.display = 'block';
                    document.body.style.overflow = ''; // Habilita el scroll de nuevo
                }, 700); // Coincide con la duración de la transición de opacidad
            }

            /**
             * Obtiene la ubicación del usuario mediante la API de Geolocalización del navegador.
             * @returns {Promise<string|null>} El código de país (ej. 'VEN', 'PER'), o null si falla o se deniega el permiso.
             */
            async function getUserGeolocationCountry() {
                return new Promise(resolve => {
                    if (!navigator.geolocation) {
                        console.warn('Geolocalización no soportada por este navegador.');
                        return resolve(null);
                    }

                    // Pide la ubicación del usuario
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;
                            console.log(`Ubicación obtenida: Lat ${lat}, Lon ${lon}`);

                            try {
                                // Usa Nominatim (OpenStreetMap) para geocodificación inversa
                                // Se recomienda incluir un 'user-agent' o 'Referer' si es posible,
                                // pero para una simple llamada en el cliente, esto suele ser suficiente.
                                // Revisa la política de uso de Nominatim: https://operations.osmfoundation.org/policies/nominatim/
                                const nominatimUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;
                                const response = await fetch(nominatimUrl, {
                                    headers: {
                                        // 'User-Agent': 'VacanoStore/1.0 (tu_email@ejemplo.com)' 
                                    }
                                });
                                const data = await response.json();
                                
                                if (data && data.address && data.address.country_code) {
                                    return resolve(data.address.country_code.toUpperCase());
                                }
                                console.warn('No se pudo obtener el código de país de Nominatim.');
                                resolve(null);
                            } catch (error) {
                                console.error('Error al obtener el país de Nominatim:', error);
                                resolve(null);
                            }
                        },
                        (error) => {
                            console.error('Error de geolocalización:', error.message);
                            if (error.code === error.PERMISSION_DENIED) {
                                console.warn('El usuario denegó el permiso de geolocalización.');
                                loadingText.textContent = 'Permiso denegado.';
                                loadingRegion.textContent = 'Redirigiendo a la tienda por defecto...';
                                loadingIconDisplay.textContent = '🚫';
                            } else {
                                loadingText.textContent = 'Error al detectar.';
                                loadingRegion.textContent = 'Redirigiendo a la tienda por defecto...';
                                loadingIconDisplay.textContent = '⚠️';
                            }
                            resolve(null);
                        },
                        {
                            enableHighAccuracy: false,
                            timeout: 5000,
                            maximumAge: 0
                        }
                    );
                });
            }

            /**
             * Redirige al usuario o muestra la selección manual.
             */
            async function handleRedirection() {
                loadingText.textContent = 'Cargando';
                loadingRegion.textContent = 'Pidiendo permiso de ubicación...';
                loadingIconDisplay.textContent = '📍';

                const countryCode2Letter = await getUserGeolocationCountry();
                console.log('Código de país detectado (2 letras):', countryCode2Letter); 

                let target = null;
                let finalCountryCode = null; 

                if (countryCode2Letter === 'VE') {
                    finalCountryCode = 'VEN';
                } else if (countryCode2Letter === 'PE') {
                    finalCountryCode = 'PER';
                }

                if (finalCountryCode && countryRedirects[finalCountryCode]) {
                    target = countryRedirects[finalCountryCode];
                } else {
                    target = defaultRedirect; 
                }

                loadingText.textContent = 'Cargando...';
                loadingRegion.textContent = `Redirigiendo a ${target.name}...`;
                loadingIconDisplay.textContent = target.emoji;

                setTimeout(() => {
                    window.location.href = target.url;
                }, 2500); 
            }

            handleRedirection();
        });
    </script>
</body>
</html>